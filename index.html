<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>El Impostor del F√∫tbol</title>

  <!-- Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root{
      --field-dark:#1B5E20;
      --field-mid:#2E7D32;
      --field-light:#388E3C;
      --gold:#FFD700;
      --impostor:#7f1d1d; /* granate */
      --innocent:#065f46; /* esmeralda */
    }
    html,body{height:100%;}
    body{
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(1200px 800px at 50% 30%, rgba(56,142,60,.35), rgba(27,94,32,.85)),
        repeating-linear-gradient(90deg,
          rgba(56,142,60,.12) 0px,
          rgba(56,142,60,.12) 80px,
          rgba(27,94,32,.10) 80px,
          rgba(27,94,32,.10) 160px
        ),
        linear-gradient(180deg, var(--field-mid), var(--field-dark));
      color: #fff;
      overflow-x: hidden;
    }
    .field-lines{
      position:fixed; inset:0;
      pointer-events:none;
      background:
        radial-gradient(circle at 50% 55%, rgba(255,255,255,.10) 0 2px, transparent 2px 100%),
        linear-gradient(90deg, transparent 49.6%, rgba(255,255,255,.10) 49.6% 50.4%, transparent 50.4%),
        linear-gradient(0deg, transparent 14.8%, rgba(255,255,255,.08) 14.8% 15.2%, transparent 15.2%),
        linear-gradient(0deg, transparent 84.8%, rgba(255,255,255,.08) 84.8% 85.2%, transparent 85.2%);
      opacity:.55;
      mix-blend-mode: overlay;
    }
    .game-card{
      background: rgba(0,0,0,0.85);
      border: 2px solid var(--gold);
      border-radius: 1.25rem;
      backdrop-filter: blur(5px);
      box-shadow: 0 0 0 1px rgba(255,215,0,.15), 0 30px 60px rgba(0,0,0,.6);
    }
    .neon{
      color: var(--gold);
      text-shadow: 0 0 10px rgba(255,215,0,.35), 0 0 24px rgba(255,215,0,.25);
    }
    .btn-primary{
      background: var(--gold);
      color:#111827;
    }
    .btn-primary:hover{ filter: brightness(1.05); transform: translateY(-1px); }
    .btn-secondary{
      background: rgba(255,255,255,.08);
      border: 1px solid rgba(255,255,255,.14);
    }
    .btn-secondary:hover{ background: rgba(255,255,255,.12); transform: translateY(-1px); }
    .btn-danger{
      background: rgba(239,68,68,.18);
      border: 1px solid rgba(239,68,68,.35);
    }
    .btn-danger:hover{ background: rgba(239,68,68,.26); transform: translateY(-1px); }
    .blink{
      animation: blink 1.1s ease-in-out infinite;
    }
    @keyframes blink{
      0%,100%{opacity:1}
      50%{opacity:.35}
    }
    .pill{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.06);
    }
    .role-innocent{
      background: linear-gradient(135deg, rgba(6,95,70,.95), rgba(16,185,129,.18));
      border: 1px solid rgba(16,185,129,.35);
    }
    .role-impostor{
      background: linear-gradient(135deg, rgba(127,29,29,.95), rgba(239,68,68,.18));
      border: 1px solid rgba(239,68,68,.35);
    }
    .small-muted{ color: rgba(255,255,255,.75); }
    .divider{ height:1px; background: rgba(255,255,255,.10); }
    .kbd{
      font-size:.75rem;
      padding:.12rem .4rem;
      border-radius:.4rem;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.25);
      color: rgba(255,255,255,.85);
    }
  </style>
</head>

<body>
  <div class="field-lines"></div>

  <main class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-3xl">
      <div id="app"></div>

      <div class="mt-4 text-center text-xs small-muted">
        <span class="kbd">Tip</span> Jug√° pasando el celular/compu: nadie mire la pantalla cuando no le toca üòÑ
      </div>
    </div>
  </main>

  <script>
    // =========================
    // 2) LISTAS (>= 100 c/u)
    // =========================
    const FOOTBALLERS = [
      "Lionel Messi","Cristiano Ronaldo","Diego Maradona","Pel√©","Johan Cruyff","Ronaldinho","Zinedine Zidane","Ronaldo Naz√°rio",
      "Thierry Henry","Andr√©s Iniesta","Xavi Hern√°ndez","Sergio Busquets","Luka Modriƒá","Toni Kroos","Karim Benzema","Kylian Mbapp√©",
      "Erling Haaland","Neymar Jr.","Luis Su√°rez","Robert Lewandowski","Kevin De Bruyne","Mohamed Salah","Sadio Man√©","Virgil van Dijk",
      "Sergio Ramos","Gerard Piqu√©","Paolo Maldini","Franco Baresi","Alessandro Nesta","Fabio Cannavaro","Roberto Carlos","Marcelo",
      "Dani Alves","Philipp Lahm","Manuel Neuer","Iker Casillas","Gianluigi Buffon","Thibaut Courtois","Petr ƒåech","Oliver Kahn",
      "Andriy Shevchenko","George Weah","Marco van Basten","Ruud Gullit","Dennis Bergkamp","Arjen Robben","Franck Rib√©ry","David Beckham",
      "Paul Scholes","Steven Gerrard","Frank Lampard","Wayne Rooney","Ryan Giggs","Roy Keane","Alan Shearer","Harry Kane","Son Heung-min",
      "Gareth Bale","Eden Hazard","Antoine Griezmann","Paul Pogba","N'Golo Kant√©","Rodri","Jude Bellingham","Vin√≠cius J√∫nior",
      "Federico Valverde","√Ångel Di Mar√≠a","Paulo Dybala","Sergio Ag√ºero","Carlos Tevez","Javier Mascherano","Juan Rom√°n Riquelme",
      "Gabriel Batistuta","Hern√°n Crespo","Claudio Caniggia","Mario Kempes","Daniel Passarella","Javier Zanetti","Francesco Totti",
      "Alessandro Del Piero","Andrea Pirlo","Gennaro Gattuso","Clarence Seedorf","Kak√°","Roberto Baggio","Gianfranco Zola",
      "Luis Figo","Rivaldo","Rom√°rio","Rui Costa","Ra√∫l","Fernando Torres","David Villa","Ibrahimoviƒá","Samuel Eto'o","Didier Drogba",
      "Yaya Tour√©","Patrick Vieira","Zlatko Daliƒá","Davor ≈†uker","Hristo Stoichkov","Gheorghe Hagi","Michael Laudrup",
      "Lothar Matth√§us","Franz Beckenbauer","Gerd M√ºller","Miroslav Klose","Thomas M√ºller","Bastian Schweinsteiger","Mesut √ñzil",
      "Sergio Rebrov","Henrik Larsson","Zico","S√≥crates","Garrincha","Kenny Dalglish","George Best","Bobby Charlton",
      "Michel Platini","Eric Cantona","Lev Yashin","Roberto Fern√°ndez","Alexis S√°nchez","Arturo Vidal","James Rodr√≠guez",
      "Radamel Falcao","Edinson Cavani","Diego Forl√°n","Hugo S√°nchez","Rafa M√°rquez","Cuauht√©moc Blanco","Tim Cahill",
      "Landon Donovan","Clint Dempsey","Hirving Lozano","Heung-min Son","Park Ji-sung","Keisuke Honda","Shinji Kagawa",
      "Samuel Umtiti","Rapha√´l Varane","William Saliba","R√∫ben Dias","Jo√£o Cancelo","Trent Alexander-Arnold","Andrew Robertson"
    ];

    const CLUBS = [
      "Real Madrid","FC Barcelona","Atl√©tico de Madrid","Sevilla FC","Valencia CF","Athletic Club","Real Sociedad","Villarreal",
      "Manchester United","Manchester City","Liverpool","Chelsea","Arsenal","Tottenham Hotspur","Newcastle United","Aston Villa",
      "Leicester City","Everton","West Ham United","Leeds United",
      "Bayern M√ºnchen","Borussia Dortmund","RB Leipzig","Bayer Leverkusen","Schalke 04","Hamburger SV","Werder Bremen","Eintracht Frankfurt",
      "Juventus","AC Milan","Inter","Napoli","AS Roma","Lazio","Atalanta","Fiorentina","Torino","Bologna",
      "Paris Saint-Germain","Olympique de Marseille","Olympique Lyonnais","AS Monaco","Lille","Stade Rennais",
      "Ajax","PSV Eindhoven","Feyenoord","AZ Alkmaar",
      "Benfica","FC Porto","Sporting CP","Braga",
      "Celtic","Rangers",
      "Galatasaray","Fenerbah√ße","Be≈üikta≈ü",
      "Olympiacos","Panathinaikos",
      "Shakhtar Donetsk","Dynamo Kyiv",
      "Red Star Belgrade","Partizan",
      "Club Brugge","Anderlecht",
      "Basel","Young Boys",
      "Boca Juniors","River Plate","Racing Club","Independiente","San Lorenzo","V√©lez Sarsfield","Estudiantes","Newell's Old Boys",
      "Rosario Central","Lan√∫s",
      "Flamengo","Palmeiras","S√£o Paulo","Corinthians","Santos","Gr√™mio","Internacional","Atl√©tico Mineiro","Cruzeiro",
      "Vasco da Gama","Botafogo",
      "Pe√±arol","Nacional",
      "Colo-Colo","Universidad de Chile","Universidad Cat√≥lica",
      "Club Am√©rica","Chivas Guadalajara","Cruz Azul","Pumas UNAM","Tigres UANL","Monterrey",
      "LA Galaxy","Inter Miami","New York City FC","Seattle Sounders","Atlanta United","Toronto FC",
      "Al Ahly","Zamalek","Wydad Casablanca","Esperance de Tunis",
      "Al Hilal","Al Nassr","Al Ittihad",
      "Kashima Antlers","Urawa Red Diamonds","Yokohama F. Marinos",
      "Guangzhou FC","Shanghai Port",
      "Sydney FC","Melbourne Victory",
      "Copenhagen","Br√∏ndby","Malm√∂ FF","AIK","Hammarby",
      "Sparta Prague","Slavia Prague","Ferencv√°ros","Legia Warsaw"
    ];

    // =========================
    // 3) STATE √öNICO
    // =========================
    const state = {
      view: "START", // START | ROLE_ASSIGNMENT | SHOW_ROLE | DISCUSSION | REVEAL
      category: "FOOTBALLERS", // FOOTBALLERS | CLUBS
      players: [],
      secretWord: "",
      currentIndex: 0,
      assignments: [], // [{name, role}]
      impostorCount: 1,
      timer: {
        duration: 300,      // 5:00
        remaining: 300,
        started: false,
        running: false,
        intervalId: null
      },
      error: ""
    };

    // =========================
    // HELPERS
    // =========================
    function clamp(n, min, max){ return Math.max(min, Math.min(max, n)); }

    function calcImpostors(n){
      if (n >= 9) return 3;
      if (n >= 6) return 2;
      return 1; // 3-5
    }

    function fmtTime(sec){
      const s = Math.max(0, sec|0);
      const mm = String(Math.floor(s/60)).padStart(2,"0");
      const ss = String(s%60).padStart(2,"0");
      return `${mm}:${ss}`;
    }

    function pickRandom(arr){
      return arr[Math.floor(Math.random()*arr.length)];
    }

    function uniqueRandomIndices(count, maxExclusive){
      const set = new Set();
      while(set.size < count){
        set.add(Math.floor(Math.random()*maxExclusive));
      }
      return Array.from(set);
    }

    function categoryLabel(cat){
      return cat === "FOOTBALLERS" ? "Jugadores de F√∫tbol" : "Clubes de F√∫tbol";
    }

    function secretLabel(cat){
      return cat === "FOOTBALLERS" ? "El Jugador Secreto es:" : "El Club Secreto es:";
    }

    function getList(cat){
      return cat === "FOOTBALLERS" ? FOOTBALLERS : CLUBS;
    }

    function clearError(){ state.error = ""; }

    // =========================
    // 5) FUNCIONES GLOBALES (window.*)
    // =========================
    window.setCategory = function(cat){
      if (state.view !== "START") return;
      state.category = (cat === "CLUBS") ? "CLUBS" : "FOOTBALLERS";
      clearError();
      render();
    }

    window.addPlayer = function(){
      if (state.view !== "START") return;

      const input = document.getElementById("playerInput");
      if (!input) return;

      let name = (input.value || "").trim();
      if (!name) return;

      if (state.players.length >= 12){
        state.error = "M√°ximo 12 jugadores.";
        render();
        return;
      }

      // Normalizaci√≥n suave (evita duplicados exactos por espacios)
      name = name.replace(/\s+/g, " ");

      state.players.push(name);
      input.value = "";
      clearError();
      render();
    }

    window.removePlayer = function(idx){
      if (state.view !== "START") return;
      state.players.splice(idx, 1);
      clearError();
      render();
    }

    window.startRoleAssignment = function(){
      if (state.view !== "START") return;

      const n = state.players.length;
      if (n < 3){
        state.error = "Necesit√°s al menos 3 jugadores.";
        render();
        return;
      }
      if (n > 12){
        state.error = "M√°ximo 12 jugadores.";
        render();
        return;
      }

      state.impostorCount = calcImpostors(n);

      // Elegir secreto
      state.secretWord = pickRandom(getList(state.category));

      // Asignar roles
      const impostorIdx = uniqueRandomIndices(state.impostorCount, n);
      state.assignments = state.players.map((name, i) => ({
        name,
        role: impostorIdx.includes(i) ? "IMPOSTOR" : "INNOCENT"
      }));

      // Reset flujo
      state.currentIndex = 0;
      state.view = "ROLE_ASSIGNMENT";
      clearError();

      // Reset timer
      stopTimer();
      state.timer.remaining = state.timer.duration;
      state.timer.started = false;
      state.timer.running = false;

      render();
    }

    window.showMyCard = function(){
      if (state.view !== "ROLE_ASSIGNMENT") return;
      state.view = "SHOW_ROLE";
      render();
    }

    window.nextAfterCard = function(){
      if (state.view !== "SHOW_ROLE") return;

      if (state.currentIndex < state.players.length - 1){
        state.currentIndex += 1;
        state.view = "ROLE_ASSIGNMENT";
        render();
      } else {
        state.view = "DISCUSSION";
        render();
        startTimerIfNeeded();
      }
    }

    window.revealNow = function(){
      if (state.view !== "DISCUSSION") return;
      state.view = "REVEAL";
      stopTimer();
      render();
    }

    window.restartMatch = function(){
      // Conserva jugadores, vuelve a START
      state.view = "START";
      state.secretWord = "";
      state.assignments = [];
      state.currentIndex = 0;
      stopTimer();
      state.timer.remaining = state.timer.duration;
      state.timer.started = false;
      state.timer.running = false;
      clearError();
      render();
    }

    // =========================
    // TIMER
    // =========================
    function startTimerIfNeeded(){
      if (state.timer.started) return;
      state.timer.started = true;
      state.timer.running = true;

      state.timer.intervalId = setInterval(() => {
        if (!state.timer.running) return;
        state.timer.remaining -= 1;
        if (state.timer.remaining <= 0){
          state.timer.remaining = 0;
          stopTimer();
          // Auto revelar cuando llega a 0
          state.view = "REVEAL";
        }
        render();
      }, 1000);
    }

    function stopTimer(){
      state.timer.running = false;
      if (state.timer.intervalId){
        clearInterval(state.timer.intervalId);
        state.timer.intervalId = null;
      }
    }

    // =========================
    // 4) RENDER √öNICO
    // =========================
    function render(){
      const app = document.getElementById("app");
      if (!app) return;

      // Actualiza impostores estimados (solo START)
      if (state.view === "START"){
        state.impostorCount = calcImpostors(state.players.length);
      }

      const header = `
        <div class="game-card p-6 sm:p-8">
          <div class="flex items-center justify-between gap-3">
            <div>
              <h1 class="text-2xl sm:text-3xl font-extrabold neon tracking-tight">
                El Impostor del F√∫tbol
              </h1>
              <div class="mt-1 small-muted text-sm">
                Un juego social r√°pido: inocentes ven la palabra‚Ä¶ impostores no üòà
              </div>
            </div>
            <div class="hidden sm:flex items-center gap-2">
              <span class="pill px-3 py-1 rounded-full text-xs">
                Categor√≠a: <span class="font-semibold text-white">${categoryLabel(state.category)}</span>
              </span>
              <span class="pill px-3 py-1 rounded-full text-xs">
                Jugadores: <span class="font-semibold text-white">${state.players.length}</span>/12
              </span>
            </div>
          </div>
          <div class="divider my-5"></div>
          ${renderView()}
        </div>
      `;

      app.innerHTML = header;

      // foco √∫til
      if (state.view === "START"){
        const input = document.getElementById("playerInput");
        if (input) input.focus();
      }
    }

    function renderView(){
      switch(state.view){
        case "START": return renderStart();
        case "ROLE_ASSIGNMENT": return renderRoleAssignment();
        case "SHOW_ROLE": return renderShowRole();
        case "DISCUSSION": return renderDiscussion();
        case "REVEAL": return renderReveal();
        default: return renderStart();
      }
    }

    // =========================
    // VISTAS
    // =========================
    function renderStart(){
      const n = state.players.length;
      const impostors = calcImpostors(n);
      const canStart = n >= 3 && n <= 12;

      const playersList = state.players.length
        ? `<div class="mt-4 grid sm:grid-cols-2 gap-2">
            ${state.players.map((p, i) => `
              <div class="flex items-center justify-between gap-3 pill rounded-xl px-3 py-2">
                <div class="truncate">
                  <span class="font-semibold">${escapeHtml(p)}</span>
                </div>
                <button
                  class="btn-danger px-3 py-2 rounded-xl text-sm font-semibold transition"
                  onclick="removePlayer(${i})"
                  title="Eliminar"
                >
                  ‚úñ
                </button>
              </div>
            `).join("")}
          </div>`
        : `<div class="mt-4 small-muted text-sm pill rounded-xl p-4">
            Agreg√° jugadores para empezar. M√≠nimo <b>3</b>, m√°ximo <b>12</b>.
          </div>`;

      return `
        <div class="grid gap-5">
          <div class="grid sm:grid-cols-2 gap-3">
            <button
              class="w-full btn-secondary px-4 py-4 rounded-2xl font-extrabold text-lg transition ${state.category==="FOOTBALLERS"?"ring-2 ring-[var(--gold)]":""}"
              onclick="setCategory('FOOTBALLERS')"
            >
              ‚öΩ JUGADORES
              <div class="text-sm font-semibold small-muted mt-1">Palabra secreta: un futbolista</div>
            </button>

            <button
              class="w-full btn-secondary px-4 py-4 rounded-2xl font-extrabold text-lg transition ${state.category==="CLUBS"?"ring-2 ring-[var(--gold)]":""}"
              onclick="setCategory('CLUBS')"
            >
              üèüÔ∏è CLUBES
              <div class="text-sm font-semibold small-muted mt-1">Palabra secreta: un club</div>
            </button>
          </div>

          <div class="pill rounded-2xl p-4">
            <div class="flex flex-wrap items-center justify-between gap-2">
              <div class="text-sm small-muted">
                Con <b class="text-white">${n}</b> jugador(es) se jugar√° con:
              </div>
              <div class="text-lg font-extrabold neon">
                ${impostors} IMPOSTOR${impostors>1?"ES":""} üî¥
              </div>
            </div>
          </div>

          <div>
            <label class="block text-sm font-semibold mb-2">Agregar jugador</label>
            <div class="flex gap-2">
              <input
                id="playerInput"
                class="w-full rounded-2xl px-4 py-3 bg-black/40 border border-white/10 focus:outline-none focus:ring-2 focus:ring-[var(--gold)]"
                placeholder="Ej: Federico"
                maxlength="30"
                onkeydown="if(event.key==='Enter'){ addPlayer(); }"
              />
              <button class="btn-primary px-5 py-3 rounded-2xl font-extrabold transition" onclick="addPlayer()">
                + A√±adir
              </button>
            </div>

            ${state.error ? `<div class="mt-2 text-sm text-red-300 font-semibold">${escapeHtml(state.error)}</div>` : ``}

            ${playersList}
          </div>

          <button
            class="w-full ${canStart ? "btn-primary" : "btn-secondary opacity-50 cursor-not-allowed"} px-6 py-4 rounded-2xl font-extrabold text-lg transition"
            onclick="${canStart ? "startRoleAssignment()" : "void(0)"}"
            ${canStart ? "" : "disabled"}
          >
            INICIAR ASIGNACI√ìN DE ROLES
          </button>

          <div class="small-muted text-xs">
            Roles: <span class="font-semibold text-emerald-300">Inocente ‚≠ê</span> | <span class="font-semibold text-red-300">Impostor üî¥</span>
          </div>
        </div>
      `;
    }

    function renderRoleAssignment(){
      const name = state.players[state.currentIndex] || "(Jugador)";
      return `
        <div class="text-center grid gap-5">
          <div class="small-muted text-sm">
            Pas√° el dispositivo al siguiente jugador
          </div>

          <div class="text-3xl sm:text-5xl font-extrabold blink neon">
            ${escapeHtml(name)}
          </div>

          <div class="pill rounded-2xl p-4 small-muted text-sm">
            Cuando est√©s listo, toc√° el bot√≥n y mir√° tu tarjeta <b>a solas</b>.
          </div>

          <button class="btn-primary w-full px-6 py-4 rounded-2xl font-extrabold text-lg transition" onclick="showMyCard()">
            ¬°SOY YO, VER MI TARJETA!
          </button>

          <div class="small-muted text-xs">
            Jugador ${state.currentIndex + 1} de ${state.players.length}
          </div>
        </div>
      `;
    }

    function renderShowRole(){
      const a = state.assignments[state.currentIndex];
      const isImpostor = a?.role === "IMPOSTOR";

      const boxClass = isImpostor ? "role-impostor" : "role-innocent";
      const title = isImpostor ? "ERES EL IMPOSTOR üî¥" : "ERES INOCENTE ‚≠ê";
      const sub = isImpostor
        ? `La Categor√≠a es: <b>${categoryLabel(state.category)}</b>`
        : `${secretLabel(state.category)} <b>${escapeHtml(state.secretWord)}</b>`;

      const btnText = (state.currentIndex === state.players.length - 1) ? "INICIAR PARTIDO" : "CONTINUAR";

      return `
        <div class="grid gap-5">
          <div class="text-center">
            <div class="small-muted text-sm mb-2">Tu tarjeta</div>
            <div class="text-2xl sm:text-3xl font-extrabold neon">${escapeHtml(a?.name || "")}</div>
          </div>

          <div class="${boxClass} rounded-2xl p-6 sm:p-8 text-center">
            <div class="text-2xl sm:text-4xl font-extrabold">${title}</div>
            <div class="mt-3 text-base sm:text-lg small-muted">
              ${sub}
            </div>

            <div class="mt-5 pill rounded-2xl p-4 text-sm small-muted">
              üìµ No digas la palabra en voz alta si sos inocente. Si sos impostor‚Ä¶ actu√° como si supieras üòè
            </div>
          </div>

          <button class="btn-primary w-full px-6 py-4 rounded-2xl font-extrabold text-lg transition" onclick="nextAfterCard()">
            ${btnText}
          </button>

          <div class="small-muted text-xs text-center">
            (Ahora pas√° el dispositivo sin que te miren)
          </div>
        </div>
      `;
    }

    function renderDiscussion(){
      return `
        <div class="grid gap-5">
          <div class="text-center">
            <div class="small-muted text-sm">Discusi√≥n</div>
            <div class="text-5xl sm:text-6xl font-extrabold neon mt-1">
              ${fmtTime(state.timer.remaining)}
            </div>
            <div class="small-muted text-sm mt-2">
              Tienen 5 minutos para debatir. El impostor intenta pasar desapercibido.
            </div>
          </div>

          <div class="pill rounded-2xl p-4 text-sm small-muted">
            Reglas r√°pidas:
            <ul class="list-disc pl-5 mt-2 space-y-1">
              <li>Hablen sin decir la palabra exacta (si sos inocente).</li>
              <li>El impostor debe fingir que conoce la palabra.</li>
              <li>Cuando quieran, revelen qui√©nes eran los impostores.</li>
            </ul>
          </div>

          <button class="btn-danger w-full px-6 py-4 rounded-2xl font-extrabold text-lg transition" onclick="revealNow()">
            MOSTRAR IMPOSTOR (¬°TARJETA ROJA AL CULPABLE!)
          </button>

          <div class="small-muted text-xs text-center">
            El cron√≥metro arranca autom√°ticamente al entrar ac√°.
          </div>
        </div>
      `;
    }

    function renderReveal(){
      const impostors = state.assignments.filter(a => a.role === "IMPOSTOR").map(a => a.name);
      const impostorsText = impostors.length ? impostors.map(escapeHtml).join(", ") : "(ninguno)";

      return `
        <div class="grid gap-5">
          <div class="text-center">
            <div class="small-muted text-sm">Revelaci√≥n</div>
            <div class="text-2xl sm:text-3xl font-extrabold neon mt-1">¬°Se termin√≥!</div>
          </div>

          <div class="pill rounded-2xl p-5">
            <div class="text-sm small-muted">La palabra secreta era</div>
            <div class="text-2xl sm:text-4xl font-extrabold mt-1">
              ${escapeHtml(state.secretWord || "‚Äî")}
            </div>
            <div class="mt-3 text-sm small-muted">
              Categor√≠a: <b class="text-white">${categoryLabel(state.category)}</b>
            </div>
          </div>

          <div class="grid sm:grid-cols-2 gap-3">
            <div class="role-impostor rounded-2xl p-5">
              <div class="font-extrabold text-lg">Impostor(es) üî¥</div>
              <div class="mt-2 small-muted">${impostorsText}</div>
            </div>

            <div class="pill rounded-2xl p-5">
              <div class="font-extrabold text-lg">Tiempo restante</div>
              <div class="mt-2 neon text-2xl font-extrabold">${fmtTime(state.timer.remaining)}</div>
            </div>
          </div>

          <div class="pill rounded-2xl p-5">
            <div class="font-extrabold text-lg mb-3">Roles finales</div>
            <div class="grid sm:grid-cols-2 gap-2">
              ${state.assignments.map(a => `
                <div class="flex items-center justify-between gap-3 px-3 py-2 rounded-xl ${a.role==="IMPOSTOR" ? "bg-red-500/10 border border-red-500/25" : "bg-emerald-500/10 border border-emerald-500/25"}">
                  <div class="truncate font-semibold">${escapeHtml(a.name)}</div>
                  <div class="text-sm font-extrabold ${a.role==="IMPOSTOR" ? "text-red-300" : "text-emerald-300"}">
                    ${a.role==="IMPOSTOR" ? "IMPOSTOR üî¥" : "INOCENTE ‚≠ê"}
                  </div>
                </div>
              `).join("")}
            </div>
          </div>

          <button class="btn-primary w-full px-6 py-4 rounded-2xl font-extrabold text-lg transition" onclick="restartMatch()">
            REINICIAR PARTIDA (conservar jugadores)
          </button>
        </div>
      `;
    }

    // =========================
    // Seguridad b√°sica para nombres
    // =========================
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // Init
    render();
  </script>
</body>
</html>


